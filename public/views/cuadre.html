<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Caja</title>
    <link rel="stylesheet" href="/css/main.css">
    <style>
        .grid-bills {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }

        .bill-item {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #eee;
        }

        .stat-value {
            font-weight: bold;
        }

        .result-box {
            text-align: center;
            padding: 20px;
            border-radius: 4px;
            margin-top: 20px;
            color: white;
        }

        .balanced {
            background: var(--success);
        }

        .mismatch {
            background: var(--danger);
        }
    </style>
</head>

<body>

    <div class="container" style="max-width:800px; margin:0 auto;">
        <h1>Gestión de Caja</h1>

        <!-- VISTA: CAJA CERRADA (APERTURA) -->
        <div id="viewClosed" class="card hidden">
            <h2>Apertura de Caja</h2>
            <p>La caja se encuentra cerrada. Ingrese el saldo inicial para comenzar.</p>

            <label>Saldo Inicial (S/)</label>
            <input type="number" id="openAmount" placeholder="0.00" step="0.01">

            <button class="btn btn-primary" style="width:100%" onclick="abrirCaja()">Abrir Caja</button>
        </div>

        <!-- VISTA: CAJA ABIERTA (DASHBOARD) -->
        <div id="viewOpen" class="card hidden">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2>Caja Abierta</h2>
                <span id="openDate" style="color:#7f8c8d; font-size:0.9em;"></span>
            </div>

            <div class="stat-row">
                <span>Saldo Inicial:</span>
                <span id="lblSaldoInicial" class="stat-value">S/ 0.00</span>
            </div>
            <div class="stat-row">
                <span>Ingresos (Hoy):</span>
                <span id="lblIngresos" class="stat-value" style="color:var(--success);">+ S/ 0.00</span>
            </div>
            <div class="stat-row">
                <span>Egresos (Hoy):</span>
                <span id="lblEgresos" class="stat-value" style="color:var(--danger);">- S/ 0.00</span>
            </div>
            <div class="stat-row"
                style="background:#ecf0f1; padding:10px; border-radius:4px; border:none; margin-top:10px;">
                <span>Saldo Teórico Actual:</span>
                <span id="lblSaldoTeorico" class="stat-value" style="font-size:1.2em; color:var(--accent);">S/
                    0.00</span>
            </div>

            <div style="margin-top:20px;">
                <h3>Últimos Movimientos</h3>
                <ul id="movementsList"
                    style="list-style:none; padding:0; max-height:200px; overflow-y:auto; border:1px solid #eee;">
                    <!-- JS populated -->
                </ul>
            </div>

            <button class="btn btn-danger" style="width:100%" onclick="iniciarCierre()">Realizar Cierre de Caja</button>
        </div>

        <!-- VISTA: CIERRE (CONTEO) -->
        <div id="viewClosing" class="card hidden">
            <h2>Arqueo de Caja</h2>
            <p>Ingrese la cantidad de billetes y monedas contados.</p>

            <div class="grid-bills" id="billsContainer">
                <!-- JS populated -->
            </div>

            <div class="stat-row" style="margin-top:20px; font-size:1.2em;">
                <span>Total Contado:</span>
                <span id="lblTotalContado">S/ 0.00</span>
            </div>

            <div style="display:flex; gap:10px; margin-top:15px;">
                <button class="btn btn-secondary" style="flex:1" onclick="cancelarCierre()">Cancelar</button>
                <button class="btn btn-success" style="flex:1" onclick="confirmarCierre()">Confirmar Cierre</button>
            </div>
        </div>

        <!-- VISTA: REPORTE FINAL -->
        <div id="viewReport" class="card hidden">
            <h2>Resumen del Cierre</h2>
            <div id="reportContent"></div>
            <button class="btn btn-primary" style="width:100%" onclick="location.reload()">Volver al Inicio</button>
        </div>

    </div>

    <script src="/js/caja.js"></script>
</body>

</html>