<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Clientes Naturales</title>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/clientes.css">
</head>

<body>
  <h2>Clientes Naturales</h2>

  <div class="tabs">
    <div class="tab active" id="tab-lista">Lista de usuarios</div>
    <div class="tab" id="tab-crear">Crear cliente</div>
  </div>

  <!-- LISTA -->
  <div class="section active" id="lista-section">
    <div class="toolbar">
      <button id="btnRecargar">Recargar</button>
      <span id="msgLista" class="loading">Cargando lista de clientes...</span>
    </div>
    <table id="tabla-clientes">
      <thead>
        <tr>
          <th>DNI</th>
          <th>Nombre</th>
          <th>Tipo de préstamo</th>
          <th>Tasa (%)</th>
          <th>Plazo (meses)</th>
          <th>Cuota mensual (S/)</th>
          <th>Deuda Total (S/)</th>
          <th>Inicio</th>
          <th>Fin</th>
          <th>Operaciones</th>
          <th>Tipo</th>
          <th>Origen (si PEP)</th>
          <th>Destino (si PEP)</th>

        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- FORMULARIO -->
  <div class="section" id="crear-section">
    <form id="crearForm">

      <label for="tipoCliente">Tipo de cliente</label>
      <select id="tipoCliente" required>
        <option value="natural" selected>Persona Natural</option>
        <option value="pep">Persona Expuesta Políticamente (PEP)</option>
      </select>


      <label for="dni">DNI</label>
      <div class="input-group">
        <input type="text" id="dni" maxlength="8" required placeholder="Ej: 12345678">
        <button type="button" id="buscarDNI">Buscar</button>
      </div>

      <label for="nombre">Nombre completo</label>
      <input type="text" id="nombre" readonly class="readonly">

      <label for="nombres">Nombres</label>
      <input type="text" id="nombres" readonly class="readonly">

      <label for="apellidoP">Apellido paterno</label>
      <input type="text" id="apellidoP" readonly class="readonly">

      <label for="apellidoM">Apellido materno</label>
      <input type="text" id="apellidoM" readonly class="readonly">

      <label for="departamento">Departamento</label>
      <input type="text" id="departamento" readonly class="readonly">

      <label for="direccionCompleta">Dirección completa</label>
      <input type="text" id="direccionCompleta" readonly class="readonly">

      <label for="email">Correo electrónico</label>
      <input type="email" id="email" required placeholder="Ej: cliente@correo.com">

      <label for="dinero">Monto del préstamo (S/)</label>
      <input type="number" id="dinero" min="0" step="0.01" required>

      <!-- Campos extra solo para PEP -->
      <div id="camposPEP" style="display:none;">
        <label for="origenFondos">Origen de los fondos</label>
        <input type="text" id="origenFondos" placeholder="Ej: Ahorros, salario, negocio...">

        <label for="destinoFondos">Destino de los fondos</label>
        <input type="text" id="destinoFondos" placeholder="Ej: Compra de vehículo, inversión...">
      </div>


      <!-- <label for="tipoPrestamo">Tipo de préstamo</label> -->
      <!-- <select id="tipoPrestamo" required> -->
      <!--   <option value="">Seleccione...</option> -->
      <!--   <option value="personal">Personal</option> -->
      <!--   <option value="vehicular">Vehicular</option> -->
      <!--   <option value="hipotecario">Hipotecario</option> -->
      <!-- ESTILO PERSONALIZADO PARA TARJETAS DE TASAS -->
      <style>
        .rate-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
          gap: 15px;
          margin-bottom: 20px;
        }

        .rate-card {
          background: #fff;
          border: 2px solid #e0e0e0;
          border-radius: 8px;
          padding: 15px;
          text-align: center;
          cursor: pointer;
          transition: all 0.3s ease;
          position: relative;
        }

        .rate-card:hover {
          border-color: #007bff;
          box-shadow: 0 4px 8px rgba(0, 123, 255, 0.1);
        }

        .rate-card.active {
          border-color: #007bff;
          background: #f0f8ff;
        }

        .rate-card input[type="checkbox"] {
          transform: scale(1.2);
          margin-bottom: 8px;
          cursor: pointer;
        }

        .rate-card label {
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 5px;
        }

        .tooltip-icon {
          background: #007bff;
          color: white;
          border-radius: 50%;
          width: 20px;
          height: 20px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 12px;
          font-weight: bold;
          cursor: help;
          position: absolute;
          top: 5px;
          right: 5px;
        }

        .tooltip-icon:hover::after {
          content: attr(data-tooltip);
          position: absolute;
          bottom: 120%;
          left: 50%;
          transform: translateX(-50%);
          background: #333;
          color: #fff;
          padding: 5px 10px;
          border-radius: 4px;
          white-space: nowrap;
          font-size: 12px;
          z-index: 10;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .rate-input-container {
          display: flex;
          align-items: center;
          justify-content: center;
          display: none;
          /* Controlled by JS */
          margin-top: 5px;
        }

        .rate-input {
          width: 60px;
          padding: 6px;
          border: 1px solid #ccc;
          border-radius: 4px;
          text-align: center;
          font-size: 1rem;
        }

        .rate-symbol {
          font-weight: bold;
          margin-left: 5px;
          color: #555;
        }
      </style>

      <label style="font-size:1.1em; margin-bottom:10px; display:block;">Tasas de Interés Aplicables</label>

      <div class="rate-grid">
        <!-- TEA Card -->
        <div class="rate-card" onclick="document.getElementById('checkTEA').click()">
          <input type="checkbox" id="checkTEA" class="rate-check" value="TEA" onclick="event.stopPropagation()">
          <label for="checkTEA">TEA <span class="tooltip-icon"
              data-tooltip="Tasa Efectiva Anual (Costo del préstamo)">?</span></label>
          <div class="rate-input-container" id="containerTEA">
            <input type="number" id="inputTEA" class="rate-input" placeholder="0.00" step="0.01" min="0"
              onclick="event.stopPropagation()">
            <span class="rate-symbol">%</span>
          </div>
        </div>

        <!-- TREA Card -->
        <div class="rate-card" onclick="document.getElementById('checkTREA').click()">
          <input type="checkbox" id="checkTREA" class="rate-check" value="TREA" onclick="event.stopPropagation()">
          <label for="checkTREA">TREA <span class="tooltip-icon"
              data-tooltip="Tasa de Rendimiento Efectiva Anual (Ganancia por ahorros)">?</span></label>
          <div class="rate-input-container" id="containerTREA">
            <input type="number" id="inputTREA" class="rate-input" placeholder="0.00" step="0.01" min="0"
              onclick="event.stopPropagation()">
            <span class="rate-symbol">%</span>
          </div>
        </div>

        <!-- TCEA Card -->
        <div class="rate-card" onclick="document.getElementById('checkTCEA').click()">
          <input type="checkbox" id="checkTCEA" class="rate-check" value="TCEA" onclick="event.stopPropagation()">
          <label for="checkTCEA">TCEA <span class="tooltip-icon"
              data-tooltip="Tasa de Costo Efectivo Anual (Costo total gastos incluidos)">?</span></label>
          <div class="rate-input-container" id="containerTCEA">
            <input type="number" id="inputTCEA" class="rate-input" placeholder="0.00" step="0.01" min="0"
              onclick="event.stopPropagation()">
            <span class="rate-symbol">%</span>
          </div>
        </div>
      </div>

      <!-- Input oculto para compatibilidad con backend si es necesario -->
      <input type="hidden" id="tasaInteres" value="0">

      <p id="tasaHelpText" style="font-size:0.85em; color:#555; margin-bottom:15px; font-style:italic;">
        Seleccione una o más tasas e ingrese sus respectivos porcentajes.
      </p>

      <label for="fechaInicio">Fecha de Inicio</label>
      <input type="date" id="fechaInicio" required>

      <label for="plazo">Plazo (meses)</label>
      <input type="number" id="plazo" required min="2" max="199" step="1" placeholder="Ingrese entre 2 y 199">

      <label for="fechaFin">Fecha de fin</label>
      <input type="date" id="fechaFin" readonly>

      <button type="submit">Guardar Cliente</button>
      <p id="msgForm"></p>
    </form>
  </div>

  <!-- MODAL -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Detalles del Cliente</h3>
        <button onclick="cerrarModal()"
          style="background:transparent; border:none; font-size:1.5em; color:#333; margin:0;">&times;</button>
      </div>

      <div class="modal-body">
        <div id="detalleCliente"></div>

        <!-- Seccion de pago dinamica en JS -->
        <div id="pagoSection"></div>
      </div>

      <div class="modal-footer">
        <button onclick="cerrarModal()" style="background:#6c757d;">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Cronograma -->
  <div id="modalCronograma" style="
    display:none;
    position:fixed;
    top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,0.5);
    justify-content:center;
    align-items:center;
  ">
    <div
      style="background:white;padding:20px;border-radius:8px;max-width:700px;width:95%;max-height:90%;overflow:auto;">
      <h3>Cronograma de pagos</h3>
      <div id="cronogramaContenido"></div>
      <button onclick="cerrarModalCronograma()">Cerrar</button>
    </div>
  </div>


  <script src="/js/utils.js"></script>
  <script src="/js/clientes.js"></script>
</body>

</html>